codemr.circlepack=function(){var e=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),t=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues);codemr.circlepack.paintCallBack=function(){p.style("fill",(function(e){return e.children?"#C6DCEC":c(e)})),p.selectAll("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}))};var n=800;function c(e){return EQ_GET_COLOR(e)}function r(e){var t=e.name,n=t.indexOf(".");return t.substring(n+1)}var i=d3.layout.pack().padding(2).size([780,780]).value((function(e){return e.value})).sort((function(e,t){var n;n=t.value-e.value;return n}));var l=d3.select("#circle-chart-body").append("div").attr("class","circlepackchart").append("svg").attr("width",n).attr("height",n).append("g").attr("transform","translate(400,400)");root=EQ_GET_DATA();{var a,o=root,s=i.nodes(root),u=l.selectAll("circle").data(s).enter().append("circle"),d=null,p=u.attr("class",(function(e){return e.parent?e.children?"node":"node node--leaf":"node node--root"})).style("fill",(function(e){return e.children?"#C6DCEC":c(e)})).style("fill-opacity",(function(e){return e.children?"0.5":"0.9"})).style("stroke",(function(e){return"#000"})).on("click",(function(e){o!==e&&(y(e),d3.event.stopPropagation())})).on("mousemove",(function(c){d!==c&&(c.metrics?e.updateMetricValues(EQ_convertMetricValues(c.metricvalues)):c.pmetrics&&t.updateMetricValues(EQ_convertMetricValues(c.pmetricvalues)),d=c,"function"==typeof updateSelectedElement&&c.parent&&(c.key?updateSelectedElement(c.parent.name,c.key):updateSelectedElement(c.name,""))),h(c),function(t){movingOnElement=!0,elem=document.getElementById("circle-chart-body"),boundingRect=elem.getBoundingClientRect();var c=n,r=n,i=e.getWidth();h(t);var l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=d3.event.pageX,s=d3.event.pageY;if(d3.event.pageX>boundingRect.left+c/2){var u=l-o;o<i&&(u=l-i),d3.select("#circle-pack-tooltip").style("right",u+"px"),d3.select("#circle-pack-tooltip").style("left","auto")}else{var d=o;o+i>l&&(d=l-i),d3.select("#circle-pack-tooltip").style("left",d+"px"),d3.select("#circle-pack-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+r/2?(d3.select("#circle-pack-tooltip").style("bottom",a-s+"px"),d3.select("#circle-pack-tooltip").style("top","auto")):(d3.select("#circle-pack-tooltip").style("top",s+"px"),d3.select("#circle-pack-tooltip").style("bottom","auto"))}(c)}));u.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var m=l.selectAll("text").data(s).enter().append("text");m.attr("class","circlelabel").style("display",(function(e){return e.parent===root?null:"none"})).text((function(e){return r(e)}));m.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var f=l.selectAll("circle,text");function y(e){o=e,d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",(function(e){var t=d3.interpolateZoom(a,[o.x,o.y,2*o.r+20]);return function(e){v(t(e))}})).selectAll("text").filter((function(e){return!!e&&(e.parent===o||"inline"===this.style.display)})).style("fill-opacity",(function(e){return e.parent===o?1:0})).each("start",(function(e){e.parent===o&&(this.style.display="inline")})).each("end",(function(e){e.parent!==o&&(this.style.display="none")})),e.metrics&&eQ.MetricChart.updateDots(e.metrics,r(e))}d3.select("body").on("click",(function(){y(root)})),v([root.x,root.y,2*root.r+20])}function v(e){var t=n/e[2];a=e,f.attr("transform",(function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"})),p.attr("r",(function(e){return e.r*t}))}function h(n){d3.event.ctrlKey||d3.event.metaKey?!function(e){return!e.children}(n)?function(e){return!(!e.children||!e.parent)}(n)&&(e.setVisible(!1),t.setVisible(!0)):(e.setVisible(!0),t.setVisible(!1)):(e.setVisible(!1),t.setVisible(!1))}d3.select(self.frameElement).style("height","850px")};
