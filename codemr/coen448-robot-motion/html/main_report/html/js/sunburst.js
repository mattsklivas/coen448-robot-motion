codemr.sunburst=function(){metricChartManagerForClass=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),metricChartManagerForPackage=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues),codemr.sunburst.paintCallBack=function(){y.style("fill",(function(t){return d(t)}))};var t=0,e=null,n=800,r=800,a=Math.min(n,r)/2,i=d3.scale.linear().range([0,2*Math.PI]),o=d3.scale.linear().range([0,a]),c=(d3.scale.category20c(),!0);d3.select("#sunburst-chart-body").on("mousemove",(function(){c||(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1)),c=!1}));var s=d3.select("#sunburst-chart-body").append("svg").attr("width",n).attr("height",r).attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 800 800").append("g").attr("transform","translate(400,400)"),u=d3.layout.partition().value((function(t){return t.value})),l=d3.svg.arc().startAngle((function(t){return Math.max(0,Math.min(2*Math.PI,i(t.x)))})).endAngle((function(t){return Math.max(0,Math.min(2*Math.PI,i(t.x+t.dx)))})).innerRadius((function(t){return Math.max(0,o(t.y))})).outerRadius((function(t){return Math.max(0,o(t.y+t.dy))}));function d(t){return EQ_GET_COLOR(t)}function m(n){return t+1>=n.depth==0||null!=e&&0==h(e,n)||Math.max(0,o(n.y))*(Math.min(2*Math.PI,i(n.x+n.dx))-Math.min(2*Math.PI,i(n.x)))<14?"hidden":"visible"}function p(e){if(t+1>=e.depth){0;var n=e.name,r=n.indexOf(".");return n.substring(r+1)}return""}function h(t,e){return t===e||!!t.children&&t.children.some((function(t){return h(t,e)}))}var f=d3.select("#sunburst-tooltip");root=EQ_GET_DATA();{var g=s.selectAll("g").data(u.nodes(root)).enter().append("g");d3.select("g").append("svg:image").attr("x",-78).attr("y",-78).attr("width",156).attr("height",156).on("mouseover",(function(){d3.select(this).moveToBack()}));var y=g.append("path").attr("d",l).style("fill",(function(t){return d(t)})).on("click",M).on("mouseover",E).on("mouseout",k).on("mousemove",b),v=g.append("text").attr("text-anchor",(function(t){return F(t)?"start":"end"})).attr("pointer-events","none").attr("transform",(function(t){return"rotate("+V(t)+")translate("+o(t.y)+")rotate("+(F(t)?"0":"-180")+")"})).attr("dx",(function(t){return F(t)?"5":"-5"})).attr("dy",".35em").text(p).style("visibility",(function(t){return m(t)})).on("click",M).on("mouseover",E).on("mouseout",k).on("mousemove",b);function M(n){e!==n&&(t=n.depth,e=n,v.transition().attr("opacity",0).style("visibility",(function(t){return m(t)})).style("pointer-events","none"),y.transition().duration(750).attrTween("d",function(t){var e=d3.interpolate(i.domain(),[t.x,t.x+t.dx]),n=d3.interpolate(o.domain(),[t.y,1]),r=d3.interpolate(o.range(),[t.y?20:0,a]);return function(t,a){return a?function(e){return l(t)}:function(a){return i.domain(e(a)),o.domain(n(a)).range(r(a)),l(t)}}}(n)).each("end",(function(t,e){if(t.x>=n.x&&t.x<n.x+n.dx){var r=d3.select(this.parentNode).select("text");r.transition().duration(750).attr("opacity",1).attr("text-anchor",(function(t){return F(t)?"start":"end"})).attr("transform",(function(){return"rotate("+V(t)+")translate("+o(t.y)+")rotate("+(F(t)?"0":"-180")+")"})).attr("dx",(function(t){return F(t)?"5":"-5"})),r.text(p).style("visibility",(function(t){return m(t)}))}})))}function b(t){f.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px"),x(t),function(t){c=!0,elem=document.getElementById("sunburst-chart-body"),boundingRect=elem.getBoundingClientRect();var e=n,a=r;x(t);var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,s=d3.event.pageX,u=d3.event.pageY,l=metricChartManagerForClass.getWidth();if(d3.event.pageX>boundingRect.left+e/2){var d=i-s;s<l&&(d=i-l),d3.select("#sunburst-tooltip").style("right",d+"px"),d3.select("#sunburst-tooltip").style("left","auto")}else{var m=s;s+l>i&&(m=i-l),d3.select("#sunburst-tooltip").style("left",m+"px"),d3.select("#sunburst-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+a/2?(d3.select("#sunburst-tooltip").style("bottom",o-u+"px"),d3.select("#sunburst-tooltip").style("top","auto")):(d3.select("#sunburst-tooltip").style("top",u+"px"),d3.select("#sunburst-tooltip").style("bottom","auto"))}(t)}function x(t){d3.event.ctrlKey||d3.event.metaKey?!function(t){return!t.children}(t)?function(t){return!(!t.children||!t.parent)}(t)&&(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!0)):(metricChartManagerForClass.setVisible(!0),metricChartManagerForPackage.setVisible(!1)):(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1))}d3.select("g g").transition().duration(200).attr("opacity","0"),d3.select("g g").transition().duration(200).attr("opacity","1"),d3.selection.prototype.moveToBack=function(){return this.each((function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)}))};var C=null;function E(t){return f.select("#name").html((function(){return function(t){return"<b>"+t.name+"</b><br>"+EQ_getSelectedMetricName(t)+":"+EQ_GET_METRICVALUE(t)+"<br>Level:"+EQ_GET_METRIC_LEVEL_STR(t)}(t)})),C!==t&&(t.metrics?metricChartManagerForClass.updateMetricValues(EQ_convertMetricValues(t.metricvalues)):t.pmetrics&&metricChartManagerForPackage.updateMetricValues(EQ_convertMetricValues(t.pmetricvalues)),C=t,"function"==typeof updateSelectedElement&&t.parent&&(t.key?updateSelectedElement(t.parent.name,t.key):updateSelectedElement(t.name,""))),x(t),f.transition().duration(50).style("opacity",.9)}function k(t){false}}function V(n){return n===e||0===t&&0===n.depth?0:(i(n.x+n.dx/2)-Math.PI/2)/Math.PI*180}function F(t){var e=V(t);return e<0&&(e+=360),!(e>90&&e<=270)}d3.select(self.frameElement).style("height","850px")};
